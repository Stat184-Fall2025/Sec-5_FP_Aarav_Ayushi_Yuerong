---
title: "2023 NYC Airport Flights Delay Rate Investigation"
author: "Yuerong Shu, Aarav Johri, Ayushi Bisaria"
format: pdf
editor: visual
jupyter: python3
---

# Purpose of the Analysis

##The purpose of this data analysis is to examine patterns in flight departure delays at New York City’s three major airports—John F. Kennedy International Airport (JFK), LaGuardia Airport (LGA), and Newark Liberty International Airport (EWR)—using flight data from 2023. Given that many East Coast college students rely on these airports for both domestic and international travel, understanding when and where delays are most likely to occur has clear practical value for travel planning.

##In this analysis, we apply techniques learned throughout the semester, including data cleaning, summarization, and visualization. These methods are used to explore how departure delays vary across airports and over time. By identifying trends in departure times and delay rates, this project aims to provide insight into the operational performance of NYC-area airports while demonstrating effective use of data analysis tools and methods.


# Libraries Used

```{r}
library(tidyverse)
library(lubridate)
library(nycflights23)
library(dplyr)
```

#Data Wrangling - Clean and Prepare Data for Analysis

```{r}
Flights <- nycflights23::flights %>%
  select(year, month, day, dep_delay, dep_time, arr_delay, arr_time, origin) %>% # dep-time and arr-time are saved here in case we want to do investigation on stat of what time section of day have the most possibility of delay
  mutate(
    flight_date = make_date(year, month, day) # date compressed into format yyyy-mm-dd using year, month, day columns, more precise to view
  ) %>%
  select(flight_date, dep_delay, dep_time, arr_delay, arr_time, origin)%>%
  filter(!is.na(dep_delay), !is.na(arr_delay)) #filter invalid rows

head(Flights)
```


#Data Analysis - To Extract Meaning from the Data
```{r}
Delay_rates <- Flights %>% 
  summarise(
    dep_delay_rate = mean(dep_delay > 15),  
    arr_delay_rate = mean(arr_delay > 15) # According to U.S. Department of Transportation, only flights arrived 15 minutes later than planned will be considered a delayed flight, though there is no regulation of delayed departure, we will still use 15 minutes rule here
  )
Delay_rates
```
It is obvious that departure delay rate and arrival delay rate shares similar value, suggesting that these 2 values can be highly correlated. 

## Making datasets only containing flights of one single airport at a time to make graphs
```{r}
JFK_flights <- Flights %>%
  filter(origin == "JFK") %>%              # keep only flights from JFK
  select(flight_date, dep_delay, dep_time, arr_delay, arr_time) 

EWR_flights <- Flights %>%
  filter(origin == "EWR") %>%              # keep only flights from EWR
  select(flight_date, dep_delay, dep_time, arr_delay, arr_time) 

LGA_flights <- Flights %>%
  filter(origin == "LGA") %>%              # keep only flights from LGA
  select(flight_date, dep_delay, dep_time, arr_delay, arr_time) 

```

## Clearly Displying Results from our Data Analysis
```{r}
# Compute delay rates for each airport
JFK_delay_rates <- calculate_delay_rates(JFK_flights)
EWR_delay_rates <- calculate_delay_rates(EWR_flights)
LGA_delay_rates <- calculate_delay_rates(LGA_flights)

# Display the results
JFK_delay_rates
EWR_delay_rates
LGA_delay_rates

delay_rates_all <- bind_rows(
  #The purpose of this code is to organize the results of the table into one organized data set
  
  JFK_delay_rates %>% mutate(Airport = "JFK"),
  EWR_delay_rates %>% mutate(Airport = "EWR"),
  LGA_delay_rates %>% mutate(Airport = "LGA")
)

total_delay_rates <- delay_rates_all %>%
  summarise(
    Airport = "Across All Three Airports",
    across(where(is.numeric), ~ round(mean(.x, na.rm = TRUE), 4))
  )

final_delay_table <- bind_rows(delay_rates_all, total_delay_rates)

final_delay_table
```

# Analyzing Factors that Can Cause FLight Delay
## (1) Is there a correlation between the time of day the flight departs/arrives vs the rate of delay. 

### Morning -5:00 AM to 12:00 PM | Afternoon- 12:00 PM to 5:00 PM | Evening - 5:00 PM to 8:00 PM | Night - 8:00 PM to 5:00 AM 

```{r}
Flights_cat <- Flights %>%
  mutate(
    month = month(flight_date),
    time_period = case_when(
      dep_time >= 500 & dep_time < 1200 ~ "Morning",
      dep_time >= 1200 & dep_time < 1700 ~ "Afternoon",
      dep_time >= 1700 & dep_time < 2100 ~ "Evening",
      TRUE ~ "Night"
    ),
    delayed = dep_delay > 15
  )

# Delay rate by time period
delay_by_time <- Flights_cat %>%
  group_by(time_period) %>%
  summarise(
    delay_rate = mean(delayed),
    n = n(),
    .groups = "drop"
  )

delay_by_time

```
###The table shows a clear relationship between departure time period and flight delay rate. Morning flights have the lowest delay rate (10.3%), while delay rates increase throughout the day, peaking at night (51.3%). Afternoon (20.0%) and evening flights (28.9%) experience progressively higher delays, suggesting that delays accumulate as the day progresses. This pattern indicates that earlier departures are generally more reliable, whereas late-night flights are most susceptible to delays.

## (2) Is there a correlation between the time of year (the month) the flight departs/arrives vs the rate of delay. 
### Numbers 1 through 12, correlate to the months of the year that correspond to from Janurary to December. 

```{r}
delay_by_month <- Flights_cat %>%
  group_by(month) %>%
  summarise(
    delay_rate = mean(delayed),
    n = n(),
    .groups = "drop"
  )

delay_by_month

```


# Data Visualization 
## Through this practice, we hope to clearly present our data and results so that anyone can see trends in the results, and extract meaningful insights from our analysis. 

## Plot number of delayed departures by origin airport

```{r}
ggplot(late_departures, aes(x = origin, y = n, fill = origin)) +
  geom_col() +
  labs(
    title = "Delayed Departures by Airport",
    x = "Origin Airport",
    y = "Number of Late Flights"
  ) +
  guides(fill = "none")

```


### Through this visual representation of the number of delayed departures by airport, we can clearly see the EWR airport has had the highest number of delayed flights. 

## Plot number of delayed arrivals by origin airport

```{r}
ggplot(late_arrivals, aes(x = origin, y = n, fill = origin)) +
  geom_col() +
  labs(
    title = "Delayed Arrivals by Airport of Departure",
    x = "Origin Airport",
    y = "Number of Late Flights"
  ) +
  guides(fill = "none")
```

###Through this visual representation of the number of delayed arrivals by airport of departure, we see similar results. Flights that have left from the EWR airport have had the highest number of delayed arrivals. These results make sense, as delayed departures will ideally result in delayed arrivals. 

```{r}
#delay by month bar plot
ggplot(delay_by_month, aes(x = factor(month), y = delay_rate)) +
  geom_col() +
  labs(
    title = "Departure Delay Rate (>15 min) by Month (All NYC Airports)",
    x = "Month",
    y = "Delay Rate"
  ) +
  theme_minimal()
```

### This bar plot shows the proportion of flights departing more than 15 minutes late for each month across all NYC airports. Delay rates are highest during the summer months, peaking in July, and remain elevated in June and August. In contrast, delay rates are lowest in the fall, particularly in October and November. This seasonal pattern suggests that summer travel demand and operational congestion contribute significantly to higher delay probabilities.


# Create a one-way ANOVA to analyze if the airport is an important factor in influencing delay.

## This answers questions like whether there is a difference in delay rate across airports, if yes, is it statistically different
```{r}
anova_data <- Flights_cat %>%
  mutate(delayed_num = as.numeric(delayed)) %>%
  select(origin, delayed_num)

anova_result <- aov(delayed_num ~ origin, data = anova_data)
summary(anova_result)
```

### A one-way ANOVA reveals a highly significant difference in departure delay rates across NYC airports (F = 583.9, p < 2e-16). This suggests that airport-specific operational factors play an important role in influencing flight delay outcomes
